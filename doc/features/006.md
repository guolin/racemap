# Feature 006: SLALOM Course航线

> **创建时间**: 2025-08-16  
> **优先级**: P1 (中)  
> **估时**: 1天  
> **状态**: 待实施

## 📋 摘要

基于国际风帆联合会（World Sailing）标准，实现SLALOM Course（障碍航线）绘制功能。该航线专为风帆滑水竞赛设计，支持PD/SD两种启航方向配置和灵活的航段长度比例调整。

## 🎯 航线绘制方法

### 标点定义
- **信号船**: 航线原点，带橙色旗帜标识
- **起航标**: 横风起航线的另一端
- **1标**: 第一个绕标点
- **2标**: 第二个绕标点  
- **3标**: 第三个绕标点，位于2标-终点标连线中点的偏移位置
- **终点标**: 终点线标记，位于2标的上风方向

### 连线布局
1. **起航线**: 信号船 - 起航标（横风方向）
2. **leg1**: 起航线 - 1标（横风到达航段）
3. **leg2**: 1标 - 2标（下风航段）  
4. **leg3**: 2标 - 3标（横风航段）
5. **leg4**: 3标 - 终点线（回到终点）
6. **终点线**: 沿航线方向的线段

### 位置计算规则
- **信号船**: 作为原点
- **起航标**: 沿航线方向+180°，距离为起航线长度
- **1标**: 根据PD/SD方向确定：
  - **SD方向**: 从起航线中点，沿航线方向-90°（绝对方向）
  - **PD方向**: 从起航线中点，沿航线方向+90°（绝对方向）
  - 距离为基础航线距离
- **2标**: 从1标出发，沿航线方向，距离为基础航线距离 × Leg2比例  
- **终点标**: 从2标出发，沿航线方向，距离可设置（默认为200米）
- **3标**: 位于2标和终点标连线的中点，然后根据PD/SD方向偏移：
  - **SD方向**: 沿270°方向（绝对西方向）偏移
  - **PD方向**: 沿90°方向（绝对东方向）偏移
  - 偏移距离可设置，默认为1倍基础航线距离

### 详细定位计算
1. **起航标位置**:
   - 从信号船出发，沿航线方向+180°
   - 距离 = startLineM

2. **1标位置**:
   - 起航线中点 = (信号船坐标 + 起航标坐标) / 2
   - 从起航线中点出发：
     - SD: 沿航线方向-90°（绝对方向），距离 = distanceNm
     - PD: 沿航线方向+90°（绝对方向），距离 = distanceNm

3. **2标位置**:
   - 从1标出发，沿航线方向
   - 距离 = distanceNm × leg2Ratio

4. **终点标位置**:
   - 从2标出发，沿航线方向
   - 距离 = finishDistance

5. **3标位置**:
   - 先计算2标-终点标连线中点
   - 从中点出发偏移：
     - SD: 沿270°方向（绝对西方向），距离 = distanceNm × mark3Offset
     - PD: 沿90°方向（绝对东方向），距离 = distanceNm × mark3Offset

6. **终点线绘制**:
   - 在终点标位置，绘制沿航线方向的线段
   - 线段长度 = finishLineLength
   - 线段中心点为终点标位置
   - 一端：蓝色标记
   - 另一端：蓝色小船标记
   - 不绘制终点标本身，只绘制终点线和两端标记

### 几何关系说明
- **航线方向**: 等于风向（向下吹）
- **PD/SD**: Port-Down/Starboard-Down，决定1标和3标的偏移方向
- **横风启航**: 起航线垂直于风向，便于快速起航

## 🔧 航线参数

### 核心几何参数
- **axis** (度): 0-360°，航线方向（等于风向）
- **distanceNm** (海里): 0.1-2.0海里，基础航线距离
- **startLineM** (米): 20-100米，起航线长度，默认30米

### 航线方向
- **direction**: 'PD' | 'SD'，启航方向选择
  - PD: Port-Down（左舷启航）
  - SD: Starboard-Down（右舷启航）

### 航段长度比例
- **leg2Ratio**: Leg2长度比例，默认1.0，范围0.5-1.5
- **finishDistance**: 2标到终点标距离，Nm
- **mark3Offset**: 3标偏移距离，默认1倍基础航线距离，范围0.5-2.0

### 终点线参数
- **finishLineLength** (米): 20-100米，终点线长度，默认30米

## 🎨 视觉表现

### 航线颜色
- 起航线: 橙色 (#ff7f0e)
- leg1: 蓝色 (#1f77b4) 
- leg2: 蓝色 (#1f77b4)
- leg3: 蓝色 (#1f77b4)
- leg4: 蓝色 (#1f77b4)

### 标记图标
- 信号船: S标记，橙色旗帜
- 起航标: 起航线标记
- 1标: 数字1标记，红色圆圈
- 2标: 数字2标记，红色圆圈  
- 3标: 数字3标记，红色圆圈
- 终点线左端: 蓝色标记
- 终点线右端: 蓝色小船标记