# Feature 006: iQFoil LW航线

> **创建时间**: 2025-08-16  
> **优先级**: P1 (中)  
> **估时**: 1天  
> **状态**: 待实施

## 📋 摘要

基于国际风帆联合会（World Sailing）iQFoil级别标准，实现iQFoil轻量级（LW - Lightweight）航线绘制功能。该航线专为风帆滑水竞赛设计，支持LWP/LWS两种方向配置和灵活的航段长度比例调整。

## 🎯 航线绘制方法

### 标点定义
- **信号船**: 航线原点，带橙色旗帜标识
- **1标**: 迎风标
- **2标**: 横风标  
- **3标**: 下风标
- **终点线**: 2标-3标连线作为终点线

### 连线布局
1. **起航线**: 信号船 - 起航标（垂直于主轴方向）
2. **leg1**: 起航线中点 - 1标（迎风航段）
3. **leg2**: 1标 - 2标（横风航段）  
4. **leg3**: 2标 - 3标（下风航段）
5. **终点线**: 2标 - 3标连线（蓝色标识）

### 位置计算规则
- **信号船**: 作为原点
- **起航标**: 垂直于主轴方向，距离为起航线长度
- **1标**: 从起航线中点出发，沿主轴方向，距离为基础航线距离
- **2标**: 从1标出发，根据LWP/LWS方向确定：
  - **LWP方向**: 沿1标到起航线中点方向顺时针旋转Mark3角度
  - **LWS方向**: 沿1标到起航线中点方向逆时针旋转Mark3角度
  - 距离为基础航线距离 × Leg1比例
- **3标**: 从2标出发，沿主轴反方向，距离为基础航线距离 × Leg3比例

### 几何关系说明
- **Mark3角度**: 2标相对于1标-起航线中点连线的偏转角度，默认105°
- **LWP/LWS**: 表示Port/Starboard方向，决定2标在左舷还是右舷
- **Final leg**: 从3标回到起航线中点附近的最终航段长度比例

## 🔧 航线参数

### 核心几何参数
- **axis** (度): 0-360°，主轴方向（迎风方向）
- **distanceNm** (海里): 0.1-2.0海里，基础航线距离
- **startLineM** (米): 20-100米，起航线长度，默认30米

### 航线方向
- **direction**: 'LWP' | 'LWS'，航线方向选择
  - LWP: Left Wing Port（左舷方向）
  - LWS: Left Wing Starboard（右舷方向）

### 航段长度比例
- **leg1Ratio**: Leg1长度比例，默认1/2 (0.5)，范围1/4-1
- **leg3Ratio**: Leg3长度比例，默认1/4 (0.25)，范围1/8-1/2
- **finalLegRatio**: Final leg长度比例，默认1/4 (0.25)，范围1/8-1/2

### 标记角度
- **mark3Angle** (度): 60-120°，Mark3角度，默认105°

### 终点线参数
- **finishLineLength** (米): 20-100米，终点线长度，默认30米
- **gateBottomOffset** (海里): 0.01-0.2海里，门标底部偏移，默认0.05海里

## 🎨 视觉表现

### 航线颜色
- 起航线: 橙色 (#ff7f0e)
- leg1: 蓝色 (#1f77b4) 
- leg2: 绿色 (#2ca02c)
- leg3: 蓝色 (#1f77b4)
- 终点线: 蓝色粗线 (#1f77b4)，宽度4px

### 标记图标
- 信号船: S标记，橙色旗帜
- 1标: 数字1标记，红色圆圈
- 2标: 数字2标记，红色圆圈  
- 3标: 数字3标记，红色圆圈
- 终点线: 蓝色三角形标识

## 📱 用户交互

### 基础/高级模式切换
- **基础模式**: 只显示核心参数（航向、距离、方向）
- **高级模式**: 显示完整参数配置，包括各航段比例、角度等

### 实时参数调整
支持实时调整所有参数，航线动态重绘，提供标准风力条件下的预设配置。

### 预设配置
- **轻风配置** (5-10节): 较长航段，较小角度
- **中风配置** (10-15节): 标准比例设置  
- **强风配置** (15-25节): 较短航段，便于控制

## 🏁 竞赛特点

### 适用条件
- **风力范围**: 5-25节
- **比赛时长**: 12-16分钟目标时间
- **参赛人数**: 适合大规模fleet racing
- **装备**: iQFoil级别风帆滑水板

### 战术要点
- 起航策略至关重要，起航线相对较短
- 迎风航段考验上风技巧
- 横风航段是关键的战术决策点
- 下风航段速度和路线选择并重
- 终点线设计增加最后冲刺的变数